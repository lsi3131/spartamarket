{% extends "base.html" %}
{% load static %}

{% block content %}
    <style scoped>
        .signup-center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #signupForm {
            flex-direction: column;
        }

        .customInput {
            width: 300px;
            margin-top: -5px;
        }

        .file-input-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #imagePreview {
            width: 100px;
            height: 100px;
            margin-left: -100px;
            display: none;
        }

        .profile-text {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: larger;
            margin-bottom: 12px;
        }
    </style>

    <div class="signup-center customLogo loginLogoBox textOrange">
        <img class="navbar-image-logo marginRight16" src="{% static "kkyul.png" %}" alt="ğŸŠ">
        <span>íšŒì›ê°€ì…</span>
        <img class="navbar-image-logo marginLeft16" src="{% static "kkyul.png" %}" alt="ğŸŠ">
    </div>

    <form id="signupForm" class="signup-center" method="post" enctype="multipart/form-data"
          action="{% url 'accounts:signup' %}">
        {% csrf_token %}
        <span class="regNameState"></span><br>
        <input type="text" class="customInput" name="regName" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"><br>
        <input type="password" class="customInput" name="regPass" placeholder="íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”"><br>
        <input type="password" class="customInput" name="chkPass" placeholder="íŒ¨ìŠ¤ì›Œë“œë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”"><br>
        <span class="regMailState"></span><br>
        <input type="email" name="regEmail" class="customInput" placeholder="ì´ë©”ì¼ì„ í˜•ì‹ì— ë§ì¶° ì‘ì„±í•´ ì£¼ì„¸ìš”"><br>
        <div class="file-input-container">
            <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                <span class="profile-text textOrange">í”„ë¡œí•„ ì‚¬ì§„</span>
                <div style="display: flex; flex-direction: row;">
                    <input type="file" name="regImage" id="regPic" onchange="previewFile()">
                    <img id="imagePreview">
                </div>
            </div>
        </div>
        <textarea name="regComment" class="customInput" style="margin-top: 40px;" placeholder="ì†Œê°œê¸€ì„ ì‘ì„±í•´ ì£¼ì„¸ìš”."></textarea>
        <button type="button" style="width: 300px;" class="btn btn-primary marginTop16" onclick="signupCheck()">íšŒì›ê°€ì…
        </button>
    </form>

    <script>
        let usernameBool = false;
        const usernameInput = document.querySelector('input[name="regName"]');
        const usernameState = document.querySelector('.regNameState');
        const userpassInput = document.querySelector('input[name="regPass"]');
        const userCheckpassInput = document.querySelector('input[name="chkPass"]');
        const csrfTokenInput = document.querySelector('input[name="csrfmiddlewaretoken"]');

        usernameInput.addEventListener('keyup', function () {
            const username = usernameInput.value.trim();
            const csrfToken = csrfTokenInput.value.trim();
            if (username.length > 4) {
                fetch('/accounts/check_name_dup/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify({username: username})
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data)
                        if (data.isDuplicate) {
                            usernameState.innerHTML = "ì‚¬ìš©ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤.";
                            usernameBool = false;
                        } else {
                            usernameState.innerHTML = "ì‚¬ìš©ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.";
                            usernameBool = true;
                        }
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                usernameState.innerHTML = "ì•„ì´ë””ëŠ” 5ìë¦¬ ì´ìƒìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”.";
                usernameBool = false;
            }
        });

        function signupCheck() {
            const userPass = userpassInput.value.trim();
            const userChkPass = userCheckpassInput.value.trim();
            if (!usernameBool) {
                alert("ì…ë ¥í•˜ì‹  ì•„ì´ë””ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”");
            } else if (userPass !== userChkPass) {
                alert("íŒ¨ìŠ¤ì›Œë“œê°€ ì„œë¡œ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            } else {
                document.getElementById("signupForm").submit();
            }
        }
    </script>
{% endblock %}